---
title: "Go の標準ライブラリでプログレスバーを作る！〜ターミナルに色が描画される仕組み〜"
emoji: "😽"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["tui", "Go"]
published: false
---

# はじめに

皆さんは普段開発している中で、様々な CLI ツールを使われていると思います。例えば、`git status` で表示される色付きの差分、`npm install` で表示されるプログレスバー、`curl` のダウンロード進捗など、ターミナル上で動的に更新される UI やカラフルな表示を目にすることがあるのではないでしょうか。

「こういうの、どうやって実装しているんだろう？」と気になったことはありませんか？

実は、これらの多くは**ANSI エスケープシーケンス**という特殊な文字列を使って実現されています。そして、Go の標準ライブラリだけでも、外部パッケージに頼ることなく、カラフルでインタラクティブなターミナル UI を作ることができるんです。

本記事では、Go の標準ライブラリのみを使ってプログレスバーを実装しながら、ターミナルに色や動的な表示が描画される仕組みについて解説していきます。

## この記事で学べること

- ANSI エスケープシーケンスの基本
- Go の標準ライブラリでシンプルなプログレスバーを実装する方法

# ANSI エスケープシーケンスとは？

ANSI エスケープシーケンスは、ターミナル（端末エミュレータ）に対して「文字の色を変えて」「カーソルを表示/非表示にして」といった指示を送るための特殊な文字列です。

1970年代に ANSI（米国規格協会）によって標準化されたもので、現在でも多くのターミナルでサポートされています。

## 基本構文

ANSI エスケープシーケンスは、以下の形式で記述します：

```/dev/null/ansi.txt#L1-1
ESC [ パラメータ コマンド
```

- **ESC**：エスケープ文字（ASCII コード `0x1B` または `\x1b`、`\033`、`\e`）
- **[**：CSI（Control Sequence Introducer）の開始を示す
- **パラメータ**：数値や記号（セミコロンで区切って複数指定可能）
- **コマンド**：実行する操作を示すアルファベット

例えば、背景色を緑にするには `\x1b[42m` というエスケープシーケンスを使います。

## 今回使用するエスケープシーケンス

プログレスバーを実装するために、以下の5つのエスケープシーケンスを使用します：

| エスケープシーケンス | 説明 |
|---|---|
| `\x1b[?25l` | カーソルを非表示にする |
| `\x1b[?25h` | カーソルを表示する |
| `\r` | 行頭に戻る（キャリッジリターン） |
| `\x1b[42m` | 背景を緑にする |
| `\x1b[0m` | すべてのスタイルをリセット |

### それぞれの役割

**カーソルの表示制御**
プログレスバーを表示している間、点滅するカーソルが表示されると見た目が悪くなります。そこで、描画中はカーソルを非表示にし、完了後に再表示します。

**行頭への移動**
`\r` は厳密には ANSI エスケープシーケンスではなく、キャリッジリターンという制御文字です。これを使うことで、同じ行に何度も上書きして表示できます。

**色設定**
`\x1b[42m` で背景色を緑に設定し、プログレスバーの進行部分を視覚的に表現します。`\x1b[0m` はすべてのスタイル（色、太字など）をデフォルトに戻すためのシーケンスで、これを使わないと以降の出力も緑の背景になってしまいます。

## Go で試してみる

実際に Go でこれらのエスケープシーケンスを使ってみましょう。

```go:main.go
package main

import "fmt"

const (
    CursorHide  = "\x1b[?25l"
    CursorShow  = "\x1b[?25h"
    ReturnStart = "\r"
    BgGreen     = "\x1b[42m"
    BgReset     = "\x1b[0m"
)

func main() {
    // カーソルを非表示にして、背景色を緑にしたテキストを表示
    fmt.Print(CursorHide)
    fmt.Println(BgGreen + "これは緑の背景です" + BgReset)
    fmt.Print(CursorShow)
}
```

このコードを実行すると、カーソルが一時的に非表示になり、緑の背景を持つテキストが表示された後、カーソルが再表示されます。
